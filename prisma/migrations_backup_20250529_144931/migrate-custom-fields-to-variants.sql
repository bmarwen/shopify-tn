-- Migration script to move custom field values from products to variants\n-- This should be run after updating the schema\n\n-- Note: This is a data migration script that should be run manually\n-- It moves existing custom field values from products to their first variant\n\n-- First, let's move existing CustomFieldValue records to VariantCustomFieldValue\n-- We'll attach them to the first variant of each product\n\nINSERT INTO \"VariantCustomFieldValue\" (\n  \"id\",\n  \"value\",\n  \"customFieldId\",\n  \"variantId\",\n  \"createdAt\",\n  \"updatedAt\"\n)\nSELECT \n  gen_random_uuid() as \"id\",\n  cfv.\"value\",\n  cfv.\"customFieldId\",\n  (\n    -- Get the first variant of this product\n    SELECT pv.\"id\" \n    FROM \"ProductVariant\" pv \n    WHERE pv.\"productId\" = cfv.\"productId\" \n    ORDER BY pv.\"createdAt\" ASC \n    LIMIT 1\n  ) as \"variantId\",\n  cfv.\"createdAt\",\n  NOW() as \"updatedAt\"\nFROM \"CustomFieldValue\" cfv\nWHERE cfv.\"productId\" IS NOT NULL\nAND EXISTS (\n  -- Only migrate if the product has at least one variant\n  SELECT 1 FROM \"ProductVariant\" pv WHERE pv.\"productId\" = cfv.\"productId\"\n);\n\n-- After successful migration, you can drop the old table and relations\n-- DROP TABLE \"CustomFieldValue\";\n\n-- Update the Product model to remove the customFields relation\n-- This should be done in the Prisma schema file\n